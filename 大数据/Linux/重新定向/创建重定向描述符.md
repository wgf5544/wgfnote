## 创建重定向描述符

* 在脚本中重定向输入或输出时，除了0、1和2外，还有6个文件描述符可以用，分别是3到8，加上默认的0到2，一共是九个文件描述符。这另外六个文件描述符可以重定向输入和重定向输出。可以使用其中一个重定向从文件输入或输出到文件，而标准的输入、输出和错误输出文件描述符还采用默认的方式，这样更加灵活并且可以在不同的输入或输出设备之间来回切换，下面通过例子说明。
### 一、输出文件描述符
* 使用exec命令为输出分配文件描述符，这个文件描述符会一直有效直到重新分配，如下面的例子。例：bash98.sh：

        #!/bin/bash
        # 为输出分配文件描述符3，输出到文件
        exec 3> syslog

        dir=/home/yarn/bash01

        for file in $dir/*
        do
          if [ -d "$file" ]
          then
            # 输出重定向到文件描述符3，输出到文件
            echo "$file is a directory" >&3
          fi
          if [ -f "$file" ]
          then
            # 同上
            echo "$file is a file" >&3
          fi
        done
        # 可以修改输出文件描述符3，输出到另一个文件
        exec 3> syslog2
        # 信息将输出到修改后的文件syslog2中
        echo "Select file success!" >&3
        # 又切换回syslog文件，注意：采用追加的方式，不覆盖之前输入的信息
        exec 3>> syslog
        # 输出到默认的标准输出：控制台
        echo "Test over!"

   * 如果日志文件已经存在，可以采用追加的方式而不需要重新创建文件，对文件的内容不会覆盖。另外在脚本中可以将信息输出到不同的文件，只要修改重定向后面的文件就可以了。另外需要注意的是，需要重定向输出的信息后要存在定向符、&符和要定向的文件描述符。
### 二、重定向文件描述符
* 虽然可以采用其他文件描述符的方式重新定向输出到文件或从文件中输入，但是存在的问题是需要在整个脚本中每个输出行的后面添加重定向描述符，使得代码的整洁度降低和编码的繁琐性增加。当然可以采用另一种方法，在标准输出到控制台或输出到文件来回切换，下面通过一个简单的例子说明。例：bash99.sh：

          #!/bin/bash
          # 将文件描述符3重定向到控制台
          exec 3>&1
          # 将标准输出描述符重定向到文件
          exec 1>syslog
          # 输出的内容会保存到日志文件中
          echo "标准输出重定向输出到日志文件"
          echo "显示的内容都存在日志文件中"
          # 将标准输出描述符重定向到文件描述符3，也就是重定向到控制台
          exec 1>&3
          # 输出的内容会输出到控制台
          echo "标准输出重定向到控制台"
          echo "输出的内容会输出到控制台"

   * 在上面的例子中，我们首先将文件描述符3重定向到文件描述符1的默认位置，也就是控制台。这意味着发送给文件描述符3的任何输出都将输出到控制台。然后将文件描述符1重定向输出到文件，但是需要注意的是，文件描述符3还指向标准输出，所以当文件描述符1定向到文件描述符3时，文件描述符1 又回到了默认状态，输出到控制台，通过这种方式，可以在不同的方式之间进行切换，这是一种通用的方式。
### 三、输入文件描述符
* 创建输入文件描述符的方式类似于上一个案例，首先将输入文件描述符0保存到另一个文件描述符，然后重新定向输入文件描述符到其他设备，如从文件中输入。文件输入完成后，将文件描述符0恢复到之前的状态，下面通过一个简单的例子说明。例：bash100.sh：

          #!/bin/bash
          # 将文件描述符5重定向到文件描述符0的默认位置控制台
          exec 5<&0
          # 将文件描述符0重定向到文件，从文件中读取
          exec 0<file08
          # 从文件中读取信息，read命令会自动读取文件中的数据
          while read line
          do
            # 简单的输出到控制台
            echo $line
          done
          # 文件描述符0恢复到原来的状态
          exec 0<&5
          # 从控制台接收输入
          echo -n "Input parameter: "
          # 读取输入时，read命令会从控制台读取
          read parameter
          # 使用case分支语句
          case $parameter in
              open)
              echo "Syatem start-up!"
              ;;
              close)
              echo "System stop!"
              ;;
              *)
              echo "Input error!"
              ;;
          esac

   * 这种方式是通用的方式，在不同的输入设备之间进行切换，需要注意的是，首先要保存默认状态到一个文件描述符，用于还原之前的输入设备。
### 四、关闭文件描述符
* 如果在脚本中定义了输入或输出文件描述符，在脚本执行结束后Shell会自动关闭它们，但是在有些情况下要手动关闭文件描述符，如在脚本中执行另外的脚本之前。关闭文件描述符采用下面的方式。

        exec 3>&-

   * 将文件描述符重新定向到&-会关闭文件描述符，文件描述符关闭后在脚本中就不能在使用了，如果继续使用此文件描述符，系统会提示警告信息，下面通过两个例子说明，第一个是关闭输出描述符后使用输出描述符的情况，另一个是关闭输入描述符。例：bash101.sh：
   
              #!/bin/bash
              # 将文件描述符3重定向到文件，输出到文件
              exec 3>syslog
              # 输出信息到文件描述符3
              echo "Hello Bash Shell!" >&3
              # 关闭文件描述符3
              exec 3>&-
              # 继续输出信息到文件描述符3，系统会报出警告信息
              echo "This is Bash script!" >&3

              控制台显示：
              $ bash101.sh
              ./bash101.sh: line 9: 3: 错误的文件描述符

              例：bash102.sh：
              #!/bin/bash
              # 将文件描述符3输入重定向到文件
              exec 3< file08
              # 循环读取，从文件描述符3
              while read line <&3
              do
                echo $line
              done
              # 关闭文件描述符3
              exec 3>&-
              # 又从文件描述符3读取，系统会提示警告信
              while read line <&3
              do
                echo $line
              done

      * 控制台显示：
      
              $ bash102.sh
              1501010001 71.05 2141618 3 07/11/15 21:46:57 1006 User001 109 4 303
              1501010002 865.86 1686831 2 05/11/15 03:52:44 1009 User009 109 1 302
              1501010003 652.61 2587675 2 07/14/15 19:17:39 1010 User003 110 1 305
              1501010004 905.24 1282788 1 04/17/15 17:14:09 1010 User004 102 3 304
              1501010005 444.25 1624680 1 04/05/15 11:40:51 1005 User009 108 1 308
              ./bash102.sh: line 12: 3: 错误的文件描述符

   * 注意：一旦关闭了文件描述符，就不能在使用它输入或输出信息了，否则会提示警告信息。关闭文件描述符后又打开到同一个文件时要注意>和>>的区别，第一个是创建一个新的文件，而第二个是追加到文件，通过一个例子说明。例：bash103.sh：

              #!/bin/bash
              # 将文件描述符3输出重定向到文件
              exec 3> errlog
              # 输出信息到文件描述符3
              echo "This is first test!" >&3
              # 关闭文件描述符3
              exec 3>&-
              # 重新将文件描述符3输出重定向到同一个文件
              exec 3> errlog
              # 输出信息到文件，会重新创建errlog文件之前的信息覆盖
              echo "This is second test!" >&3
              # 关闭文件描述符3
              exec 3>&-
              # 重新将文件描述符输出重定向到文件，注意：是追加信息到同一个文件
              exec 3>> errlog
              # 输出信息到文件描述符3
              echo "This is third test!" >&3

      * 控制台显示：
      
              $ bash103.sh
              $ cat errlog
              This is second test!
              This is third test!

   **要注意创建和追加的区别**。
