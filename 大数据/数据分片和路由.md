#### 系统可扩展性

数据数据规模TB到PB的海量数据，单机明显无法存储与处理如此规模的数据，只能依靠大规模集群进行存储和处理。

> 纵向扩展（scale up）：传统系统多采用纵向扩展的方式，既不是增加机器数量，而是通过改善单机硬件资源配置来解决问题。

> 横向扩展（scale out）：目前主流的大数据存储和计算系统采用此种方式，通过增加机器数量获得水平扩展的能力。

> 数据分片：将海量的数据，经过切分分配到各个机器中去，实现系统水平扩展能力，通过 ***数据复制***  实现数据的高可用性。

> 数据路由：在数据分片中，如何找到数据存储的位置

数据分片与数据复制是紧密联系的两个概念，对于海量数据，通过***数据分片***实现系统的水平扩展能力，通过***数据复制***保证数据的高可用性。由于机器可能存在隐患，为了保证数据不丢失，可将数据备份起来，客户端可从多个备份数据中选择物理距离较近的进行读取，增加了读操作的并发性又可以提高单次读的读取效率。

#### 抽象模型

数据分片和路由模型，可以看成是一个二级映射关系。

第一级映射是key-partion映射，将数据映射到数据分片空间，也就是记录数据在哪个分片，多对一的关系。

第二级映射是partion-machine映射，将数据分片映射到物理机空间，也就是记录数据分片在哪个物理机中，也是多对一的关系。

在做***数据分片***时，根据key-partition映射关系将大数据水平切割成很多的数据分片，然后再按照partition-machine映射关系将数据分片放置到对应的物理机器上。而在***数据路由***时，比如要查找某条记录的值get(key)，首先根据key-partition映射找到对应的数据分片，然后再查找partition-machine关系表，就可以知道具体哪台物理机器存储该条数据，之后即可从相应的物理机读取key对应的value内容。



####哈希分片

- RoundRobin

  哈希取模法，实际中常用的简单的数据分片方法，一层映射关系。下面是K台物理机，通过哈希函数实现数据分片的方法：

  > H(key)=hash(key) mod K，key是数据主键，K是物理机个数，H(key)是数据在物理机中的位置（编号）。

  这种方法缺乏灵活性，一旦集群中增加或减少机器都会导致数据位置的重排。

  

- 虚拟桶（Bucket）

  ***Membase***是一个内存分布式Nosql数据库，对于数据分片管理，提出了虚拟桶实现方式。特点是两层映射关系，在待存储数据和物理机中间，引入了虚拟桶层。记录key通过哈希函数映射到对应虚拟桶，虚拟桶包含多条记录信息；虚拟桶通过p-m映射关系映射到对应的物理机，多对一的关系。

  具体实现方式通过查找表来实现的，即Membase通过内存表管理这些映射关系。

  当新加入机器时，将某些虚拟桶从原先分配的机器重新分配各机器，只需要修改partition-machine映射表中受影响的个别条目就能实现扩展，具有较强的灵活性。

- 一致性哈希

  ***分布式哈希表（DHT）***是P2P网络和分布式存储中常见的一项技术，是通过哈希表的分布式扩展，既考虑在多机分布式环境中，每台机器负责承载部分数据的存储情形下，如何通过哈希方式对数据进行增/删/改/查等数据操作方法。DHT只是一种技术概念，具体的实现方式有很多种，***一致性哈希***是其中一种实现方式。

  

- 

