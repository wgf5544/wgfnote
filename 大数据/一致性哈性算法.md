#### 问题

普通的***余数(取模)hash***（hash(比如用户id)%服务器机器数）算法伸缩灵活性很差，当新增或者下线服务器机器时候，用户id与服务器的映射关系会大量失效。一致性hash则利用***hash环***对其进行了改进。

同时让客户端访问集群中固定的服务器。



#### 一致性hash

一个设计良好的分布式哈希方案应该具有良好的单调性，即服务节点的增减不会造成大量哈希重定位。

简单来说，一致性哈希将整个哈希值空间组织成一个虚拟的圆环，如假设某哈希函数H的值空间为0 - 2**32-1（即哈希值是一个32位无符号整形）。

缺点：集群中的机器名很类似，hash到的结果很相近，在hash环中分布比较聚集，不是很分散。key（客户端）是分散的，大量的key命中一个或者多个服务器，而一部分比较空闲，负载不均衡。



增加虚拟节点解决hash不均衡的问题：

hash不均匀主要出现在节点很少的时，只要我们的虚拟节点足够多,我们就可以让其尽可能的均匀分布在环上。



总结：

一致性hash算法是使用虚拟的环状数据结构,解决了简单hash算法中扩展性差的问题,在分布式缓存以及负载均衡中有许多的应用。